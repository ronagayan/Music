<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>השיר היומי</title>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; text-align: center; }
        
        .rotating-image { 
            width: 250px; 
            height: 250px; 
            border-radius: 50%; 
            border: 6px solid #1DB954; 
            animation: spin 3s linear infinite; 
            object-fit: cover; 
            display: none; 
            box-shadow: 0 0 30px rgba(29, 185, 84, 0.4); 
        }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        #start-btn { 
            padding: 18px 35px; 
            font-size: 1.3rem; 
            background: #1DB954; 
            color: white; 
            border: none; 
            border-radius: 50px; 
            cursor: pointer; 
            font-weight: bold; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .status-text { margin-top: 25px; font-size: 1.2rem; display: none; font-weight: 500; }
    </style>
</head>
<body>

    <button id="start-btn">תלחצי כאן מית מית
    
    <img id="loader-img" class="rotating-image" src="profile.jpg" alt="Loading">
    
    <div id="status" class="status-text">מתחבר לספוטיפיי...</div>

    <script>
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTKVvQKAjIln4KGAakwYgyTXwmKRnjoK-XJWtFeJQDx64MgVBXvRrtOMVaOWVH7Br75PlOpDaV0tLZ2/pub?output=csv';
        
        document.getElementById('start-btn').addEventListener('click', function() {
            this.style.display = 'none';
            document.getElementById('loader-img').style.display = 'block';
            document.getElementById('status').style.display = 'block';

            setTimeout(async () => {
                try {
                    // הוספת "חותמת זמן" כדי להכריח את הדפדפן להביא נתונים טריים מהטבלה
                    const cacheBuster = "&t=" + new Date().getTime();
                    const response = await fetch(SHEET_CSV_URL + cacheBuster);
                    const data = await response.text();
                    
                    // חיפוש חכם של הקישור בכל הטבלה
                    const cells = data.split(/[\n,]+/);
                    const foundLink = cells.find(cell => cell.toLowerCase().includes('spotify.com'));

                    if (foundLink) {
                        const cleanUrl = foundLink.replace(/["\r\t]/g, '').trim();
                        window.location.href = cleanUrl;
                    } else {
                        document.getElementById('status').innerText = "לא נמצא קישור ספוטיפיי בטבלה";
                    }
                } catch (e) {
                    document.getElementById('status').innerText = "שגיאת חיבור לנתונים";
                }
            }, 3000);
        });
    </script>
</body>
</html>
